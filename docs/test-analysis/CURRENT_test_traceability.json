{
  "metadata": {
    "date": "2025-11-04",
    "phase": "Phase 4",
    "total_tests": 206,
    "passing_tests": 206,
    "description": "Comprehensive test traceability mapping for all 206 tests to source code locations"
  },

  "test_config.py": {
    "TestConfigManager": {
      "test_load_config_destinations_key": {
        "source_file": "src/ConfigManager.py",
        "lines": "45-72",
        "purpose": "Verify config loading with 'destinations' key structure"
      },
      "test_combine_keyword_files_and_inline": {
        "source_file": "src/ConfigManager.py",
        "lines": "92-115",
        "purpose": "Test merging keyword files with inline keywords"
      },
      "test_env_vs_json_precedence": {
        "source_file": "src/ConfigManager.py",
        "lines": "58-62",
        "purpose": "Verify environment variables override JSON config values"
      },
      "test_malformed_json_handling": {
        "source_file": "src/ConfigManager.py",
        "lines": "45-52",
        "purpose": "Test error handling for malformed JSON config file"
      },
      "test_missing_config_file": {
        "source_file": "src/ConfigManager.py",
        "lines": "47-49",
        "purpose": "Test handling when config file doesn't exist"
      },
      "test_missing_keyword_file": {
        "source_file": "src/ConfigManager.py",
        "lines": "98-102",
        "purpose": "Test handling when keyword file doesn't exist"
      },
      "test_rss_feed_config_loading": {
        "source_file": "src/ConfigManager.py",
        "lines": "45-72",
        "purpose": "Verify RSS feed configuration loading"
      },
      "test_destination_validation_errors": {
        "source_file": "src/ConfigManager.py",
        "lines": "64-67",
        "purpose": "Test validation of invalid destination configs with defaults"
      },
      "test_env_variable_validation": {
        "source_file": "src/ConfigManager.py",
        "lines": "35-43",
        "purpose": "Test handling when required env vars are missing"
      },
      "test_keyword_file_parsing_errors": {
        "source_file": "src/ConfigManager.py",
        "lines": "92-115",
        "purpose": "Test handling malformed keyword files"
      },
      "test_empty_destinations_list": {
        "source_file": "src/ConfigManager.py",
        "lines": "117-119",
        "purpose": "Test loading config with empty destinations list"
      },
      "test_multiple_destinations": {
        "source_file": "src/ConfigManager.py",
        "lines": "45-72",
        "purpose": "Test loading config with multiple destinations"
      },
      "test_restricted_mode_flag": {
        "source_file": "src/ConfigManager.py",
        "lines": "74-90",
        "purpose": "Test restricted_mode flag parsing"
      },
      "test_parser_config_loading": {
        "source_file": "src/ConfigManager.py",
        "lines": "74-90",
        "purpose": "Test parser configuration loading"
      },
      "test_ocr_flag_parsing": {
        "source_file": "src/ConfigManager.py",
        "lines": "74-90",
        "purpose": "Test OCR flag parsing from config"
      },
      "test_telegram_channel_type_detection": {
        "source_file": "src/ConfigManager.py",
        "lines": "74-90",
        "purpose": "Test Telegram channel type detection (public vs private)"
      },
      "test_project_root_path_creation": {
        "source_file": "src/ConfigManager.py",
        "lines": "28-33",
        "purpose": "Test project root path initialization and directory creation"
      },
      "test_config_reload_support": {
        "source_file": "src/ConfigManager.py",
        "lines": "45-119",
        "purpose": "Test config can be reloaded dynamically"
      },
      "test_duplicate_destination_names_allowed": {
        "source_file": "src/ConfigManager.py",
        "lines": "45-72",
        "purpose": "Test duplicate destination names are allowed"
      }
    }
  },

  "test_message_data.py": {
    "TestMessageData": {
      "test_create_from_telegram": {
        "source_file": "src/MessageData.py",
        "lines": "10-27",
        "purpose": "Test creating MessageData from Telegram source"
      },
      "test_create_from_rss": {
        "source_file": "src/MessageData.py",
        "lines": "10-27",
        "purpose": "Test creating MessageData from RSS source"
      },
      "test_store_metadata": {
        "source_file": "src/MessageData.py",
        "lines": "10-27",
        "purpose": "Test storing custom metadata in MessageData"
      },
      "test_optional_fields_defaults": {
        "source_file": "src/MessageData.py",
        "lines": "10-27",
        "purpose": "Test optional fields have proper defaults"
      },
      "test_metadata_defaults_empty_dict": {
        "source_file": "src/MessageData.py",
        "lines": "10-27",
        "purpose": "Test metadata defaults to empty dict"
      },
      "test_timestamp_timezone_aware": {
        "source_file": "src/MessageData.py",
        "lines": "10-27",
        "purpose": "Test timestamp is timezone-aware"
      }
    }
  },

  "test_message_router.py": {
    "TestMessageRouter": {
      "test_match_keywords_case_insensitive": {
        "source_file": "src/MessageRouter.py",
        "lines": "83-97",
        "purpose": "Test keyword matching is case-insensitive"
      },
      "test_empty_keywords_forwards_all": {
        "source_file": "src/MessageRouter.py",
        "lines": "83-97",
        "purpose": "Test empty keywords list forwards all messages"
      },
      "test_parser_trim_front_lines": {
        "source_file": "src/MessageRouter.py",
        "lines": "99-116",
        "purpose": "Test parser trims lines from front of message"
      },
      "test_parser_trim_back_lines": {
        "source_file": "src/MessageRouter.py",
        "lines": "99-116",
        "purpose": "Test parser trims lines from back of message"
      },
      "test_channel_match_numeric_id": {
        "source_file": "src/MessageRouter.py",
        "lines": "44-55",
        "purpose": "Test channel matching with numeric ID"
      },
      "test_keyword_matching_ocr_text": {
        "source_file": "src/MessageRouter.py",
        "lines": "83-97",
        "purpose": "Test keyword matching includes OCR text"
      },
      "test_no_match_wrong_channel": {
        "source_file": "src/MessageRouter.py",
        "lines": "44-55",
        "purpose": "Test no destinations returned for wrong channel"
      },
      "test_parser_both_trim_directions": {
        "source_file": "src/MessageRouter.py",
        "lines": "99-116",
        "purpose": "Test parser trims from both front and back"
      },
      "test_parser_no_trimming": {
        "source_file": "src/MessageRouter.py",
        "lines": "99-116",
        "purpose": "Test parser with no trimming configured"
      },
      "test_multiple_keyword_matches": {
        "source_file": "src/MessageRouter.py",
        "lines": "83-97",
        "purpose": "Test multiple keywords matched in same message"
      },
      "test_rss_source_routing": {
        "source_file": "src/MessageRouter.py",
        "lines": "44-81",
        "purpose": "Test routing of RSS source messages by feed URL"
      },
      "test_is_channel_restricted_true": {
        "source_file": "src/MessageRouter.py",
        "lines": "118-127",
        "purpose": "Test is_channel_restricted returns True for restricted channels (NEW Phase 4)"
      },
      "test_is_channel_restricted_false": {
        "source_file": "src/MessageRouter.py",
        "lines": "118-127",
        "purpose": "Test is_channel_restricted returns False for non-restricted channels (NEW Phase 4)"
      },
      "test_is_ocr_enabled_for_channel_true": {
        "source_file": "src/MessageRouter.py",
        "lines": "129-138",
        "purpose": "Test is_ocr_enabled_for_channel returns True when OCR enabled (NEW Phase 4)"
      },
      "test_is_ocr_enabled_for_channel_false": {
        "source_file": "src/MessageRouter.py",
        "lines": "129-138",
        "purpose": "Test is_ocr_enabled_for_channel returns False when OCR disabled (NEW Phase 4)"
      }
    }
  },

  "test_metrics.py": {
    "TestMetricsCollector": {
      "test_increment_metric": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test incrementing a metric by 1"
      },
      "test_increment_by_value": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test incrementing a metric by custom value"
      },
      "test_get_all_metrics": {
        "source_file": "src/MetricsCollector.py",
        "lines": "37-39",
        "purpose": "Test retrieving all metrics"
      },
      "test_save_and_load_json": {
        "source_file": "src/MetricsCollector.py",
        "lines": "41-53",
        "purpose": "Test saving and loading metrics to/from JSON"
      },
      "test_reset_all_metrics": {
        "source_file": "src/MetricsCollector.py",
        "lines": "55-58",
        "purpose": "Test resetting all metrics to zero"
      },
      "test_get_nonexistent_metric": {
        "source_file": "src/MetricsCollector.py",
        "lines": "27-30",
        "purpose": "Test getting nonexistent metric returns 0"
      },
      "test_increment_creates_metric": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test incrementing nonexistent metric creates it"
      },
      "test_persistence_after_reset": {
        "source_file": "src/MetricsCollector.py",
        "lines": "41-58",
        "purpose": "Test metrics persist to file after reset"
      },
      "test_increment_large_value": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test incrementing by large value"
      },
      "test_multiple_increments_same_metric": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test multiple increments accumulate correctly"
      },
      "test_concurrent_metrics": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test multiple metrics can be tracked concurrently"
      },
      "test_set_metric": {
        "source_file": "src/MetricsCollector.py",
        "lines": "32-35",
        "purpose": "Test setting metric to specific value"
      },
      "test_set_vs_increment": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-35",
        "purpose": "Test difference between set and increment operations"
      },
      "test_metrics_counters_after_flow": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-39",
        "purpose": "Test metrics counters after message flow"
      },
      "test_metrics_ocr_processed_counter": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test OCR processed counter metric"
      },
      "test_metrics_time_ran_timer": {
        "source_file": "src/MetricsCollector.py",
        "lines": "32-35",
        "purpose": "Test time_ran timer metric"
      },
      "test_ocr_sent_metric_incremented": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test ocr_sent metric incremented in integration flow"
      },
      "test_ocr_sent_not_incremented_without_ocr": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test ocr_sent not incremented when OCR not used"
      },
      "test_time_ran_metric_per_session": {
        "source_file": "src/MetricsCollector.py",
        "lines": "32-35",
        "purpose": "Test time_ran metric tracks per session"
      }
    }
  },

  "test_message_queue.py": {
    "TestMessageQueue": {
      "test_enqueue_adds_item_to_queue": {
        "source_file": "src/MessageQueue.py",
        "lines": "23-37",
        "purpose": "Test enqueue adds item to queue"
      },
      "test_enqueue_sets_initial_backoff": {
        "source_file": "src/MessageQueue.py",
        "lines": "23-37",
        "purpose": "Test enqueue sets initial backoff time"
      },
      "test_get_queue_size_returns_correct_count": {
        "source_file": "src/MessageQueue.py",
        "lines": "39-41",
        "purpose": "Test get_queue_size returns correct count"
      },
      "test_clear_queue_removes_all_items": {
        "source_file": "src/MessageQueue.py",
        "lines": "43-45",
        "purpose": "Test clear_queue removes all items"
      },
      "test_retry_success_removes_from_queue": {
        "source_file": "src/MessageQueue.py",
        "lines": "74-95",
        "purpose": "Test successful retry removes item from queue"
      },
      "test_retry_failure_increments_attempt_count": {
        "source_file": "src/MessageQueue.py",
        "lines": "74-95",
        "purpose": "Test failed retry increments attempt count"
      },
      "test_max_retries_reached_drops_message": {
        "source_file": "src/MessageQueue.py",
        "lines": "74-95",
        "purpose": "Test message dropped after max retries"
      },
      "test_exponential_backoff_calculation": {
        "source_file": "src/MessageQueue.py",
        "lines": "69-72",
        "purpose": "Test exponential backoff calculation"
      },
      "test_retry_send_discord_success": {
        "source_file": "src/MessageQueue.py",
        "lines": "97-111",
        "purpose": "Test _retry_send for Discord success"
      },
      "test_retry_send_telegram_success": {
        "source_file": "src/MessageQueue.py",
        "lines": "113-136",
        "purpose": "Test _retry_send for Telegram success"
      },
      "test_retry_send_telegram_resolve_fails": {
        "source_file": "src/MessageQueue.py",
        "lines": "113-136",
        "purpose": "Test _retry_send handles Telegram entity resolution failure"
      },
      "test_retry_send_exception_caught": {
        "source_file": "src/MessageQueue.py",
        "lines": "97-136",
        "purpose": "Test _retry_send catches and logs exceptions"
      }
    }
  },

  "test_ocr_handler.py": {
    "TestOCRHandler": {
      "test_is_available_false_when_no_easyocr": {
        "source_file": "src/OCRHandler.py",
        "lines": "19-25",
        "purpose": "Test is_available returns False when easyocr not installed"
      },
      "test_extract_text_success": {
        "source_file": "src/OCRHandler.py",
        "lines": "27-41",
        "purpose": "Test successful OCR text extraction"
      },
      "test_extract_text_empty_result": {
        "source_file": "src/OCRHandler.py",
        "lines": "27-41",
        "purpose": "Test OCR with empty result"
      },
      "test_extract_text_when_unavailable": {
        "source_file": "src/OCRHandler.py",
        "lines": "27-41",
        "purpose": "Test extract_text when OCR unavailable"
      },
      "test_extract_text_handles_error": {
        "source_file": "src/OCRHandler.py",
        "lines": "27-41",
        "purpose": "Test extract_text handles errors gracefully"
      },
      "test_reader_initialization_once": {
        "source_file": "src/OCRHandler.py",
        "lines": "14-17",
        "purpose": "Test OCR reader initialized only once (lazy loading)"
      }
    }
  },

  "test_destination_handler.py": {
    "TestDestinationHandler": {
      "test_format_message_abstract": {
        "source_file": "src/DestinationHandler.py",
        "lines": "17-20",
        "purpose": "Test format_message is abstract method"
      },
      "test_send_message_abstract": {
        "source_file": "src/DestinationHandler.py",
        "lines": "22-25",
        "purpose": "Test send_message is abstract method"
      },
      "test_chunk_text_under_limit": {
        "source_file": "src/DestinationHandler.py",
        "lines": "27-34",
        "purpose": "Test text under limit returns single chunk"
      },
      "test_chunk_text_over_limit": {
        "source_file": "src/DestinationHandler.py",
        "lines": "27-34",
        "purpose": "Test text over limit returns multiple chunks"
      },
      "test_chunk_text_exact_limit": {
        "source_file": "src/DestinationHandler.py",
        "lines": "27-34",
        "purpose": "Test text exactly at limit returns single chunk"
      },
      "test_chunk_preserves_content": {
        "source_file": "src/DestinationHandler.py",
        "lines": "27-34",
        "purpose": "Test chunking preserves all content"
      },
      "test_chunk_multiple_chunks": {
        "source_file": "src/DestinationHandler.py",
        "lines": "27-34",
        "purpose": "Test multiple chunks created correctly"
      },
      "test_chunk_empty_text": {
        "source_file": "src/DestinationHandler.py",
        "lines": "27-34",
        "purpose": "Test chunking empty text"
      },
      "test_cannot_instantiate_abstract_class": {
        "source_file": "src/DestinationHandler.py",
        "lines": "10-25",
        "purpose": "Test DestinationHandler cannot be instantiated directly"
      }
    }
  },

  "test_discord_handler.py": {
    "TestDiscordHandler": {
      "test_inherits_destination_handler": {
        "source_file": "src/DiscordHandler.py",
        "lines": "11-12",
        "purpose": "Test DiscordHandler inherits from DestinationHandler"
      },
      "test_format_message_markdown": {
        "source_file": "src/DiscordHandler.py",
        "lines": "14-55",
        "purpose": "Test message formatting uses markdown"
      },
      "test_format_message_with_keywords": {
        "source_file": "src/DiscordHandler.py",
        "lines": "40-44",
        "purpose": "Test formatted message displays matched keywords"
      },
      "test_send_message_success": {
        "source_file": "src/DiscordHandler.py",
        "lines": "57-91",
        "purpose": "Test successful message send"
      },
      "test_handle_429_response": {
        "source_file": "src/DiscordHandler.py",
        "lines": "76-80",
        "purpose": "Test handling 429 rate limit response"
      },
      "test_send_message_with_media": {
        "source_file": "src/DiscordHandler.py",
        "lines": "67-74",
        "purpose": "Test sending message with media attachment"
      },
      "test_send_message_network_error": {
        "source_file": "src/DiscordHandler.py",
        "lines": "82-91",
        "purpose": "Test handling network errors"
      },
      "test_send_message_500_error": {
        "source_file": "src/DiscordHandler.py",
        "lines": "82-91",
        "purpose": "Test handling 500 server error"
      },
      "test_format_message_includes_all_fields": {
        "source_file": "src/DiscordHandler.py",
        "lines": "14-55",
        "purpose": "Test formatted message includes all fields"
      },
      "test_chunked_message_sends_multiple": {
        "source_file": "src/DiscordHandler.py",
        "lines": "93-101",
        "purpose": "Test chunked message sends multiple requests"
      },
      "test_send_message_over_2000_char_chunked": {
        "source_file": "src/DiscordHandler.py",
        "lines": "93-101",
        "purpose": "Test message over 2000 chars is chunked"
      },
      "test_send_message_exactly_2000_char_no_chunking": {
        "source_file": "src/DiscordHandler.py",
        "lines": "93-101",
        "purpose": "Test message exactly 2000 chars not chunked"
      },
      "test_format_message_with_reply_context": {
        "source_file": "src/DiscordHandler.py",
        "lines": "46-52",
        "purpose": "Test formatted message includes reply context (NEW Phase 4)"
      }
    }
  },

  "test_telegram_handler.py": {
    "TestTelegramHandler": {
      "test_inherits_destination_handler": {
        "source_file": "src/TelegramHandler.py",
        "lines": "38-39",
        "purpose": "Test TelegramHandler inherits from DestinationHandler"
      },
      "test_format_message_html": {
        "source_file": "src/TelegramHandler.py",
        "lines": "92-130",
        "purpose": "Test message formatting uses HTML"
      },
      "test_defang_url": {
        "source_file": "src/TelegramHandler.py",
        "lines": "132-140",
        "purpose": "Test URL defanging for t.me URLs"
      },
      "test_build_message_url_public": {
        "source_file": "src/TelegramHandler.py",
        "lines": "142-152",
        "purpose": "Test building public channel URL"
      },
      "test_build_message_url_private": {
        "source_file": "src/TelegramHandler.py",
        "lines": "142-152",
        "purpose": "Test building private channel URL"
      },
      "test_restricted_mode_blocks_photo": {
        "source_file": "src/TelegramHandler.py",
        "lines": "209-248",
        "purpose": "Test restricted mode blocks photos"
      },
      "test_no_media_is_allowed": {
        "source_file": "src/TelegramHandler.py",
        "lines": "209-248",
        "purpose": "Test messages without media are allowed"
      },
      "test_format_message_with_keywords": {
        "source_file": "src/TelegramHandler.py",
        "lines": "116-122",
        "purpose": "Test formatted message displays matched keywords"
      },
      "test_defang_multiple_protocols": {
        "source_file": "src/TelegramHandler.py",
        "lines": "132-140",
        "purpose": "Test defanging t.me URLs only (not other protocols)"
      },
      "test_build_message_url_numeric_public": {
        "source_file": "src/TelegramHandler.py",
        "lines": "142-152",
        "purpose": "Test building URL for numeric public channel"
      },
      "test_format_message_escapes_html": {
        "source_file": "src/TelegramHandler.py",
        "lines": "92-130",
        "purpose": "Test HTML special characters are escaped"
      },
      "test_send_message_creates_client": {
        "source_file": "src/TelegramHandler.py",
        "lines": "41-56",
        "purpose": "Test send_message creates TelegramClient"
      },
      "test_caption_limit_constant": {
        "source_file": "src/TelegramHandler.py",
        "lines": "35-36",
        "purpose": "Test CAPTION_LIMIT constant value is 1024"
      },
      "test_caption_length_validation_logic": {
        "source_file": "src/TelegramHandler.py",
        "lines": "371-384",
        "purpose": "Test caption length validation logic"
      },
      "test_send_copy_text_only_under_4096": {
        "source_file": "src/TelegramHandler.py",
        "lines": "347-403",
        "purpose": "Test send_copy with text under 4096 chars (NEW Phase 4)"
      },
      "test_send_copy_text_over_4096_chunked": {
        "source_file": "src/TelegramHandler.py",
        "lines": "390-393",
        "purpose": "Test send_copy chunks text over 4096 chars (NEW Phase 4)"
      },
      "test_send_copy_media_with_caption_under_1024": {
        "source_file": "src/TelegramHandler.py",
        "lines": "371-374",
        "purpose": "Test send_copy media with caption under 1024 (NEW Phase 4)"
      },
      "test_send_copy_media_with_caption_over_1024_captionless_plus_chunks": {
        "source_file": "src/TelegramHandler.py",
        "lines": "371-384",
        "purpose": "Test caption overflow handling - media sent captionless + text chunks (NEW Phase 4)"
      },
      "test_send_copy_media_with_caption_over_5000_captionless_plus_chunked_text": {
        "source_file": "src/TelegramHandler.py",
        "lines": "371-384",
        "purpose": "Test large caption overflow with chunking (NEW Phase 4)"
      },
      "test_send_copy_flood_wait_error_enqueues": {
        "source_file": "src/TelegramHandler.py",
        "lines": "396-399",
        "purpose": "Test FloodWaitError enqueues message (NEW Phase 4)"
      },
      "test_send_copy_generic_exception_enqueues": {
        "source_file": "src/TelegramHandler.py",
        "lines": "401-403",
        "purpose": "Test generic exception enqueues message (NEW Phase 4)"
      },
      "test_document_with_extension_and_mime_match_allowed": {
        "source_file": "src/TelegramHandler.py",
        "lines": "224-248",
        "purpose": "Test valid document allowed (NEW Phase 4)"
      },
      "test_document_with_extension_match_mime_mismatch_blocked": {
        "source_file": "src/TelegramHandler.py",
        "lines": "242",
        "purpose": "Test malware with safe extension blocked (NEW Phase 4)"
      },
      "test_document_with_mime_match_extension_mismatch_blocked": {
        "source_file": "src/TelegramHandler.py",
        "lines": "242",
        "purpose": "Test executable with safe MIME blocked (NEW Phase 4)"
      },
      "test_document_without_filename_attribute_blocked": {
        "source_file": "src/TelegramHandler.py",
        "lines": "231-237",
        "purpose": "Test document without filename blocked (NEW Phase 4)"
      },
      "test_document_without_mime_type_blocked": {
        "source_file": "src/TelegramHandler.py",
        "lines": "239-240",
        "purpose": "Test document without MIME type blocked (NEW Phase 4)"
      },
      "test_reply_context_success": {
        "source_file": "src/TelegramHandler.py",
        "lines": "154-182",
        "purpose": "Test successful reply context extraction (NEW Phase 4)"
      },
      "test_reply_context_missing": {
        "source_file": "src/TelegramHandler.py",
        "lines": "154-182",
        "purpose": "Test reply context when no reply exists (NEW Phase 4)"
      },
      "test_reply_context_long_truncated": {
        "source_file": "src/TelegramHandler.py",
        "lines": "154-182",
        "purpose": "Test long reply context is truncated (NEW Phase 4)"
      },
      "test_reply_context_malformed": {
        "source_file": "src/TelegramHandler.py",
        "lines": "154-182",
        "purpose": "Test malformed reply context handled gracefully (NEW Phase 4)"
      }
    }
  },

  "test_rss_handler.py": {
    "TestRSSHandler": {
      "test_strip_html_tags": {
        "source_file": "src/RSSHandler.py",
        "lines": "104-109",
        "purpose": "Test stripping HTML tags from content"
      },
      "test_strip_html_entities": {
        "source_file": "src/RSSHandler.py",
        "lines": "104-109",
        "purpose": "Test stripping HTML entities"
      },
      "test_format_entry_truncate_summary": {
        "source_file": "src/RSSHandler.py",
        "lines": "111-125",
        "purpose": "Test format_entry truncates long summaries"
      },
      "test_strip_html_nested_tags": {
        "source_file": "src/RSSHandler.py",
        "lines": "104-109",
        "purpose": "Test stripping nested HTML tags"
      },
      "test_strip_html_preserves_newlines": {
        "source_file": "src/RSSHandler.py",
        "lines": "104-109",
        "purpose": "Test HTML stripping preserves newlines"
      },
      "test_format_entry_no_summary": {
        "source_file": "src/RSSHandler.py",
        "lines": "111-125",
        "purpose": "Test format_entry with no summary"
      },
      "test_format_entry_with_html_in_title": {
        "source_file": "src/RSSHandler.py",
        "lines": "111-125",
        "purpose": "Test format_entry strips HTML from title"
      },
      "test_format_entry_special_characters": {
        "source_file": "src/RSSHandler.py",
        "lines": "111-125",
        "purpose": "Test format_entry handles special characters"
      },
      "test_first_run_initializes_timestamp_emits_nothing": {
        "source_file": "src/RSSHandler.py",
        "lines": "140-146",
        "purpose": "Test first run initializes timestamp without emitting"
      },
      "test_subsequent_run_reads_existing_timestamp": {
        "source_file": "src/RSSHandler.py",
        "lines": "148-152",
        "purpose": "Test subsequent run reads existing timestamp"
      },
      "test_write_last_ts_updates_file": {
        "source_file": "src/RSSHandler.py",
        "lines": "154-161",
        "purpose": "Test _write_last_ts updates timestamp file"
      },
      "test_entry_already_seen_skipped": {
        "source_file": "src/RSSHandler.py",
        "lines": "127-138",
        "purpose": "Test entries older than last_ts are skipped"
      },
      "test_entry_too_old_skipped": {
        "source_file": "src/RSSHandler.py",
        "lines": "127-138",
        "purpose": "Test entries exceeding MAX_ENTRY_AGE_DAYS skipped"
      },
      "test_entry_new_and_recent_processed": {
        "source_file": "src/RSSHandler.py",
        "lines": "127-138",
        "purpose": "Test new and recent entries are processed"
      },
      "test_extract_entry_timestamp_prefers_updated": {
        "source_file": "src/RSSHandler.py",
        "lines": "163-171",
        "purpose": "Test timestamp extraction prefers updated_parsed"
      },
      "test_extract_entry_timestamp_falls_back_to_published": {
        "source_file": "src/RSSHandler.py",
        "lines": "163-171",
        "purpose": "Test timestamp extraction falls back to published_parsed"
      },
      "test_extract_entry_timestamp_no_timestamp_returns_none": {
        "source_file": "src/RSSHandler.py",
        "lines": "163-171",
        "purpose": "Test timestamp extraction returns None when no timestamp"
      },
      "test_extract_entry_timestamp_handles_invalid": {
        "source_file": "src/RSSHandler.py",
        "lines": "163-171",
        "purpose": "Test timestamp extraction handles invalid timestamps"
      },
      "test_feed_url_uniqueness_per_destination": {
        "source_file": "src/RSSHandler.py",
        "lines": "28-45",
        "purpose": "Test feed URL uniqueness per destination"
      },
      "test_deduplication_across_destinations": {
        "source_file": "src/RSSHandler.py",
        "lines": "127-138",
        "purpose": "Test deduplication works across destinations"
      },
      "test_multiple_feeds_different_timestamps": {
        "source_file": "src/RSSHandler.py",
        "lines": "140-161",
        "purpose": "Test multiple feeds maintain separate timestamps"
      },
      "test_rss_handler_initialization": {
        "source_file": "src/RSSHandler.py",
        "lines": "24-26",
        "purpose": "Test RSSHandler initialization"
      }
    }
  },

  "test_media_handling.py": {
    "TestMediaDownload": {
      "test_download_media_success": {
        "source_file": "src/TelegramHandler.py",
        "lines": "250-258",
        "purpose": "Test successful media download"
      },
      "test_download_media_failure_returns_none": {
        "source_file": "src/TelegramHandler.py",
        "lines": "256-258",
        "purpose": "Test download failure returns None"
      },
      "test_download_media_no_media_returns_none": {
        "source_file": "src/TelegramHandler.py",
        "lines": "252-253",
        "purpose": "Test no media returns None"
      }
    },
    "TestMediaCleanup": {
      "test_cleanup_after_message_processing": {
        "source_file": "src/Watchtower.py",
        "lines": "213-219",
        "purpose": "Test cleanup after message processing"
      },
      "test_cleanup_error_logged_not_raised": {
        "source_file": "src/Watchtower.py",
        "lines": "213-219",
        "purpose": "Test cleanup errors are logged not raised"
      },
      "test_startup_cleanup_removes_leftover_files": {
        "source_file": "src/Watchtower.py",
        "lines": "87-101",
        "purpose": "Test startup cleanup removes leftover files"
      },
      "test_media_already_downloaded_reused": {
        "source_file": "src/Watchtower.py",
        "lines": "234",
        "purpose": "Test media already downloaded is reused"
      },
      "test_cleanup_nonexistent_file_skipped": {
        "source_file": "src/Watchtower.py",
        "lines": "213-219",
        "purpose": "Test cleanup skips nonexistent files"
      }
    }
  },

  "test_integration.py": {
    "TestIntegration": {
      "test_telegram_to_discord_flow": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test basic Telegram to Discord message flow"
      },
      "test_discord_429_handling": {
        "source_file": "src/DiscordHandler.py",
        "lines": "76-80",
        "purpose": "Test Discord 429 rate limit handling"
      },
      "test_metrics_messages_received": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test messages_received metric"
      },
      "test_metrics_messages_sent": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test messages_sent metric"
      },
      "test_metrics_messages_filtered": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test messages_filtered metric"
      },
      "test_metrics_messages_queued": {
        "source_file": "src/MetricsCollector.py",
        "lines": "20-25",
        "purpose": "Test messages_queued metric"
      },
      "test_keyword_filtering": {
        "source_file": "src/MessageRouter.py",
        "lines": "83-97",
        "purpose": "Test keyword filtering integration"
      },
      "test_multiple_destinations": {
        "source_file": "src/MessageRouter.py",
        "lines": "44-81",
        "purpose": "Test routing to multiple destinations"
      },
      "test_multiple_destinations_different_keywords": {
        "source_file": "src/MessageRouter.py",
        "lines": "44-97",
        "purpose": "Test multiple destinations with different keywords"
      },
      "test_parser_integration": {
        "source_file": "src/MessageRouter.py",
        "lines": "99-116",
        "purpose": "Test parser integration in message flow"
      },
      "test_send_failure_enqueues": {
        "source_file": "src/MessageQueue.py",
        "lines": "23-37",
        "purpose": "Test send failure enqueues message"
      },
      "test_exception_handling": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test exception handling in integration flow"
      },
      "test_message_chunking_discord": {
        "source_file": "src/DiscordHandler.py",
        "lines": "93-101",
        "purpose": "Test Discord message chunking"
      },
      "test_message_chunking_telegram": {
        "source_file": "src/TelegramHandler.py",
        "lines": "390-393",
        "purpose": "Test Telegram message chunking"
      },
      "test_empty_message_handling": {
        "source_file": "src/MessageRouter.py",
        "lines": "44-97",
        "purpose": "Test handling of empty messages"
      },
      "test_special_characters_formatting": {
        "source_file": "src/DiscordHandler.py",
        "lines": "14-55",
        "purpose": "Test special characters in formatting"
      },
      "test_rss_message_flow": {
        "source_file": "src/RSSHandler.py",
        "lines": "Multiple",
        "purpose": "Test RSS message flow integration"
      },
      "test_media_forwarding": {
        "source_file": "src/DiscordHandler.py",
        "lines": "67-74",
        "purpose": "Test media forwarding integration"
      },
      "test_ocr_integration": {
        "source_file": "src/OCRHandler.py",
        "lines": "27-41",
        "purpose": "Test OCR integration in message flow"
      },
      "test_queue_retry_logic": {
        "source_file": "src/MessageQueue.py",
        "lines": "74-95",
        "purpose": "Test queue retry logic integration"
      }
    }
  },

  "test_watchtower_pipeline.py": {
    "TestWatchtowerMessagePreprocessing": {
      "test_preprocess_adds_ocr_text_when_available": {
        "source_file": "src/Watchtower.py",
        "lines": "230-251",
        "purpose": "Test OCR text added during preprocessing (NEW Phase 4)"
      },
      "test_preprocess_skips_ocr_when_not_enabled": {
        "source_file": "src/Watchtower.py",
        "lines": "230-251",
        "purpose": "Test OCR skipped when not enabled (NEW Phase 4)"
      },
      "test_preprocess_generates_defanged_url": {
        "source_file": "src/Watchtower.py",
        "lines": "230-251",
        "purpose": "Test defanged URL generation (NEW Phase 4)"
      },
      "test_preprocess_handles_ocr_failure_gracefully": {
        "source_file": "src/Watchtower.py",
        "lines": "230-251",
        "purpose": "Test OCR failure handled gracefully (NEW Phase 4)"
      },
      "test_preprocess_no_media_no_ocr": {
        "source_file": "src/Watchtower.py",
        "lines": "230-251",
        "purpose": "Test no OCR when no media present (NEW Phase 4)"
      }
    },
    "TestWatchtowerDispatchLogic": {
      "test_dispatch_to_discord_destination": {
        "source_file": "src/Watchtower.py",
        "lines": "302-322",
        "purpose": "Test dispatch to Discord destination (NEW Phase 4)"
      },
      "test_dispatch_to_telegram_destination": {
        "source_file": "src/Watchtower.py",
        "lines": "302-322",
        "purpose": "Test dispatch to Telegram destination (NEW Phase 4)"
      },
      "test_dispatch_with_media_path": {
        "source_file": "src/Watchtower.py",
        "lines": "302-322",
        "purpose": "Test dispatch with media path (NEW Phase 4)"
      },
      "test_dispatch_without_media": {
        "source_file": "src/Watchtower.py",
        "lines": "302-322",
        "purpose": "Test dispatch without media (NEW Phase 4)"
      },
      "test_dispatch_metrics_incremented": {
        "source_file": "src/Watchtower.py",
        "lines": "302-322",
        "purpose": "Test metrics incremented during dispatch (NEW Phase 4)"
      }
    },
    "TestWatchtowerDiscordSending": {
      "test_send_to_discord_text_only": {
        "source_file": "src/Watchtower.py",
        "lines": "339-405",
        "purpose": "Test Discord text-only send (NEW Phase 4)"
      },
      "test_send_to_discord_with_media": {
        "source_file": "src/Watchtower.py",
        "lines": "339-405",
        "purpose": "Test Discord send with media (NEW Phase 4)"
      },
      "test_send_to_discord_success_increments_messages_sent": {
        "source_file": "src/Watchtower.py",
        "lines": "339-405",
        "purpose": "Test successful send increments messages_sent (NEW Phase 4)"
      },
      "test_send_to_discord_failure_enqueues": {
        "source_file": "src/Watchtower.py",
        "lines": "339-405",
        "purpose": "Test failed send enqueues message (NEW Phase 4)"
      },
      "test_send_to_discord_handles_format_error": {
        "source_file": "src/Watchtower.py",
        "lines": "339-405",
        "purpose": "Test format error handling (NEW Phase 4)"
      }
    },
    "TestWatchtowerTelegramSending": {
      "test_send_to_telegram_text_only": {
        "source_file": "src/Watchtower.py",
        "lines": "418-461",
        "purpose": "Test Telegram text-only send (NEW Phase 4)"
      },
      "test_send_to_telegram_with_media": {
        "source_file": "src/Watchtower.py",
        "lines": "418-461",
        "purpose": "Test Telegram send with media (NEW Phase 4)"
      },
      "test_send_to_telegram_caption_overflow_handling": {
        "source_file": "src/Watchtower.py",
        "lines": "418-461",
        "purpose": "Test caption overflow handling (NEW Phase 4)"
      },
      "test_send_to_telegram_success_increments_messages_sent": {
        "source_file": "src/Watchtower.py",
        "lines": "418-461",
        "purpose": "Test successful send increments messages_sent (NEW Phase 4)"
      },
      "test_send_to_telegram_failure_enqueues": {
        "source_file": "src/Watchtower.py",
        "lines": "418-461",
        "purpose": "Test failed send enqueues message (NEW Phase 4)"
      }
    }
  },

  "test_integration_pipeline.py": {
    "TestIntegrationPipeline": {
      "test_ocr_trigger_when_enabled_for_channel": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test OCR triggered when enabled for channel"
      },
      "test_ocr_skipped_when_not_enabled_for_channel": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test OCR skipped when not enabled"
      },
      "test_defanged_url_added_to_telegram_messages": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test defanged URL added to Telegram messages"
      },
      "test_media_restrictions_enforced_for_restricted_destinations": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test media restrictions enforced"
      },
      "test_media_blocked_when_restricted_mode_fails": {
        "source_file": "Multiple modules",
        "lines": "Integration",
        "purpose": "Test media blocked when restricted mode check fails"
      }
    }
  }
}
